<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>Find Peaks in Time Series Data — find_peaks • animovement</title><script src="../lightswitch.js"></script><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet"><link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet"><script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Find Peaks in Time Series Data — find_peaks"><meta name="description" content="Identifies peaks (local maxima) in a numeric time series, with options to filter peaks based on
height and prominence. The function handles missing values (NA) appropriately and is compatible
with dplyr's mutate. Includes flexible handling of plateaus and adjustable window size for peak detection."><meta property="og:description" content="Identifies peaks (local maxima) in a numeric time series, with options to filter peaks based on
height and prominence. The function handles missing values (NA) appropriately and is compatible
with dplyr's mutate. Includes flexible handling of plateaus and adjustable window size for peak detection."></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top " aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">animovement</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.6.0</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="nav-item"><a class="nav-link" href="../articles/animovement.html">Get started</a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-tutorial" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Tutorial</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-tutorial"><li><a class="dropdown-item" href="../articles/read-trackball.html">Read trackball data</a></li>
    <li><a class="dropdown-item" href="../articles/clean-tracks.html">Clean tracks</a></li>
    <li><a class="dropdown-item" href="../articles/calculate-kinematics.html">Calculate kinematics</a></li>
    <li><a class="dropdown-item" href="../articles/calculate-summary-statistics.html">Calculate summary statistics</a></li>
  </ul></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles"><li><a class="dropdown-item" href="../articles/mission.html">Mission &amp; Scope</a></li>
    <li><h6 class="dropdown-header" data-toc-skip>Roadmaps</h6></li>
    <li><h6 class="dropdown-header" data-toc-skip>How to contribute</h6></li>
  </ul></li>
<li class="active nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul><ul class="navbar-nav"><li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json"></form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/roaldarbol/animovement/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-lightswitch" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true" aria-label="Light switch"><span class="fa fa-sun"></span></button>
  <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="dropdown-lightswitch"><li><button class="dropdown-item" data-bs-theme-value="light"><span class="fa fa-sun"></span> Light</button></li>
    <li><button class="dropdown-item" data-bs-theme-value="dark"><span class="fa fa-moon"></span> Dark</button></li>
    <li><button class="dropdown-item" data-bs-theme-value="auto"><span class="fa fa-adjust"></span> Auto</button></li>
  </ul></li>
      </ul></div>


  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Find Peaks in Time Series Data</h1>
      <small class="dont-index">Source: <a href="https://github.com/roaldarbol/animovement/blob/main/R/find_extrema.R" class="external-link"><code>R/find_extrema.R</code></a></small>
      <div class="d-none name"><code>find_peaks.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>Identifies peaks (local maxima) in a numeric time series, with options to filter peaks based on
height and prominence. The function handles missing values (NA) appropriately and is compatible
with dplyr's mutate. Includes flexible handling of plateaus and adjustable window size for peak detection.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">find_peaks</span><span class="op">(</span></span>
<span>  <span class="va">x</span>,</span>
<span>  min_height <span class="op">=</span> <span class="op">-</span><span class="cn">Inf</span>,</span>
<span>  min_prominence <span class="op">=</span> <span class="fl">0</span>,</span>
<span>  plateau_handling <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"strict"</span>, <span class="st">"middle"</span>, <span class="st">"first"</span>, <span class="st">"last"</span>, <span class="st">"all"</span><span class="op">)</span>,</span>
<span>  window_size <span class="op">=</span> <span class="fl">3</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>


<dl><dt id="arg-x">x<a class="anchor" aria-label="anchor" href="#arg-x"></a></dt>
<dd><p>Numeric vector containing the time series data</p></dd>


<dt id="arg-min-height">min_height<a class="anchor" aria-label="anchor" href="#arg-min-height"></a></dt>
<dd><p>Minimum height threshold for peaks (default: -Inf)</p></dd>


<dt id="arg-min-prominence">min_prominence<a class="anchor" aria-label="anchor" href="#arg-min-prominence"></a></dt>
<dd><p>Minimum prominence threshold for peaks (default: 0)</p></dd>


<dt id="arg-plateau-handling">plateau_handling<a class="anchor" aria-label="anchor" href="#arg-plateau-handling"></a></dt>
<dd><p>String specifying how to handle plateaus. One of:</p><ul><li><p>"strict" (default): No points in plateau are peaks</p></li>
<li><p>"middle": Middle point(s) of plateau are peaks</p></li>
<li><p>"first": First point of plateau is peak</p></li>
<li><p>"last": Last point of plateau is peak</p></li>
<li><p>"all": All points in plateau are peaks</p></li>
</ul></dd>


<dt id="arg-window-size">window_size<a class="anchor" aria-label="anchor" href="#arg-window-size"></a></dt>
<dd><p>Integer specifying the size of the window to use for peak detection (default: 3).
Must be odd and &gt;= 3. Larger values detect peaks over wider ranges.</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    <p>A logical vector of the same length as the input where:</p><ul><li><p><code>TRUE</code> indicates a confirmed peak</p></li>
<li><p><code>FALSE</code> indicates a non-peak</p></li>
<li><p><code>NA</code> indicates peak status could not be determined due to missing data</p></li>
</ul></div>
    <div class="section level2">
    <h2 id="details">Details<a class="anchor" aria-label="anchor" href="#details"></a></h2>
    <p>The function uses a sliding window algorithm for peak detection (window size specified by window_size parameter),
combined with a region-based prominence calculation method similar to that described in Palshikar (2009).</p>
    </div>
    <div class="section level2">
    <h2 id="note">Note<a class="anchor" aria-label="anchor" href="#note"></a></h2>

<ul><li><p>The function is optimized for use with dplyr's mutate</p></li>
<li><p>For noisy data, consider using a larger window_size or smoothing the series before peak detection</p></li>
<li><p>Adjust min_height and min_prominence to filter out unwanted peaks</p></li>
<li><p>Choose plateau_handling based on your specific needs</p></li>
<li><p>Larger window_size values result in more stringent peak detection</p></li>
</ul></div>
    <div class="section level2">
    <h2 id="peak-detection">Peak Detection<a class="anchor" aria-label="anchor" href="#peak-detection"></a></h2>
    <p>A point is considered a peak if it is the highest point within its window (default window_size of 3
compares each point with its immediate neighbors). The first and last (window_size-1)/2 points in the
series cannot be peaks and are marked as NA. Larger window sizes will identify peaks that dominate over
a wider range, typically resulting in fewer peaks being detected.</p>
    </div>
    <div class="section level2">
    <h2 id="prominence">Prominence<a class="anchor" aria-label="anchor" href="#prominence"></a></h2>
    <p>Prominence measures how much a peak stands out relative to its surrounding values.
It is calculated as the height of the peak minus the height of the highest minimum
between this peak and any higher peaks (or the end of the series if no higher peaks exist).</p>
    </div>
    <div class="section level2">
    <h2 id="plateau-handling">Plateau Handling<a class="anchor" aria-label="anchor" href="#plateau-handling"></a></h2>
    <p>Plateaus (sequences of identical values) are handled according to the plateau_handling parameter:</p><ul><li><p>strict: No points in a plateau are considered peaks (traditional behavior)</p></li>
<li><p>middle: For plateaus of odd length, the middle point is marked as a peak.
For plateaus of even length, the two middle points are marked as peaks.</p></li>
<li><p>first: The first point of each plateau is marked as a peak</p></li>
<li><p>last: The last point of each plateau is marked as a peak</p></li>
<li><p>all: Every point in the plateau is marked as a peak</p></li>
</ul><p>Note that in all cases, the plateau must still qualify as a peak relative to its
surrounding window (i.e., higher than all other points in the window).</p>
    </div>
    <div class="section level2">
    <h2 id="missing-values-na-handling">Missing Values (NA) Handling<a class="anchor" aria-label="anchor" href="#missing-values-na-handling"></a></h2>
    <p>The function uses the following rules for handling NAs:</p><ul><li><p>If a point is NA, it cannot be a peak (returns NA)</p></li>
<li><p>If any point in the window is NA, peak status cannot be determined (returns NA)</p></li>
<li><p>For prominence calculations, stretches of NAs are handled appropriately</p></li>
<li><p>A minimum of window_size points is required; shorter series return all NAs</p></li>
</ul></div>
    <div class="section level2">
    <h2 id="references">References<a class="anchor" aria-label="anchor" href="#references"></a></h2>
    <p>Palshikar, G. (2009). Simple Algorithms for Peak Detection in Time-Series.
Proc. 1st Int. Conf. Advanced Data Analysis, Business Analytics and Intelligence.</p>
    </div>
    <div class="section level2">
    <h2 id="see-also">See also<a class="anchor" aria-label="anchor" href="#see-also"></a></h2>
    <div class="dont-index">
<ul><li><p><code><a href="find_troughs.html">find_troughs</a></code> for finding local minima</p></li>
<li><p><code>findpeaks</code> in the pracma package for alternative peak detection methods</p></li>
</ul></div>
    </div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="co"># Basic usage with default window size (3)</span></span></span>
<span class="r-in"><span><span class="va">x</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">3</span>, <span class="fl">2</span>, <span class="fl">6</span>, <span class="fl">4</span>, <span class="fl">5</span>, <span class="fl">2</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu">find_peaks</span><span class="op">(</span><span class="va">x</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1]    NA  TRUE FALSE  TRUE FALSE  TRUE    NA</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># With larger window size</span></span></span>
<span class="r-in"><span><span class="fu">find_peaks</span><span class="op">(</span><span class="va">x</span>, window_size <span class="op">=</span> <span class="fl">5</span><span class="op">)</span>  <span class="co"># More stringent peak detection</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1]    NA    NA FALSE  TRUE FALSE    NA    NA</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># With minimum height</span></span></span>
<span class="r-in"><span><span class="fu">find_peaks</span><span class="op">(</span><span class="va">x</span>, min_height <span class="op">=</span> <span class="fl">4</span>, window_size <span class="op">=</span> <span class="fl">3</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1]    NA FALSE FALSE  TRUE FALSE  TRUE    NA</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># With plateau handling</span></span></span>
<span class="r-in"><span><span class="va">x</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">3</span>, <span class="fl">3</span>, <span class="fl">3</span>, <span class="fl">2</span>, <span class="fl">4</span>, <span class="fl">4</span>, <span class="fl">1</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu">find_peaks</span><span class="op">(</span><span class="va">x</span>, plateau_handling <span class="op">=</span> <span class="st">"middle"</span>, window_size <span class="op">=</span> <span class="fl">3</span><span class="op">)</span>  <span class="co"># Middle of plateaus</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1]    NA FALSE  TRUE FALSE FALSE  TRUE  TRUE    NA</span>
<span class="r-in"><span><span class="fu">find_peaks</span><span class="op">(</span><span class="va">x</span>, plateau_handling <span class="op">=</span> <span class="st">"all"</span>, window_size <span class="op">=</span> <span class="fl">5</span><span class="op">)</span>     <span class="co"># All plateau points</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1]    NA    NA FALSE FALSE FALSE  TRUE  TRUE    NA</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># With missing values</span></span></span>
<span class="r-in"><span><span class="va">x</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">3</span>, <span class="cn">NA</span>, <span class="fl">6</span>, <span class="fl">4</span>, <span class="cn">NA</span>, <span class="fl">2</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu">find_peaks</span><span class="op">(</span><span class="va">x</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] NA NA NA NA NA NA NA</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Usage with dplyr</span></span></span>
<span class="r-in"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org" class="external-link">dplyr</a></span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://tibble.tidyverse.org/reference/deprecated.html" class="external-link">data_frame</a></span><span class="op">(</span></span></span>
<span class="r-in"><span>  time <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fl">10</span>,</span></span>
<span class="r-in"><span>  value <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">3</span>, <span class="fl">7</span>, <span class="fl">4</span>, <span class="fl">2</span>, <span class="fl">6</span>, <span class="fl">5</span>, <span class="fl">8</span>, <span class="fl">4</span>, <span class="fl">2</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span></span>
<span class="r-in"><span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>peaks <span class="op">=</span> <span class="fu">find_peaks</span><span class="op">(</span><span class="va">value</span>, window_size <span class="op">=</span> <span class="fl">3</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-wrn co"><span class="r-pr">#&gt;</span> <span class="warning">Warning: </span>`data_frame()` was deprecated in tibble 1.1.0.</span>
<span class="r-wrn co"><span class="r-pr">#&gt;</span> <span style="color: #00BBBB;">ℹ</span> Please use `tibble()` instead.</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #949494;"># A tibble: 10 × 3</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     time value peaks</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;lgl&gt;</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;"> 1</span>     1     1 <span style="color: #BB0000;">NA</span>   </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;"> 2</span>     2     3 FALSE</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;"> 3</span>     3     7 TRUE </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;"> 4</span>     4     4 FALSE</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;"> 5</span>     5     2 FALSE</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;"> 6</span>     6     6 TRUE </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;"> 7</span>     7     5 FALSE</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;"> 8</span>     8     8 TRUE </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;"> 9</span>     9     4 FALSE</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;">10</span>    10     2 <span style="color: #BB0000;">NA</span>   </span>
<span class="r-in"><span></span></span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by <a href="https://roald-arboel.com" class="external-link">Mikkel Roald-Arbøl</a>.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.3.</p>
</div>

    </footer></div>





  </body></html>

