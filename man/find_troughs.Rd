% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/find_troughs.R
\name{find_troughs}
\alias{find_troughs}
\title{Find Troughs in Time Series Data}
\usage{
find_troughs(
  x,
  max_height = Inf,
  min_prominence = 0,
  plateau_handling = c("strict", "middle", "first", "last", "all")
)
}
\arguments{
\item{x}{Numeric vector containing the time series data}

\item{max_height}{Maximum height threshold for troughs (default: Inf)}

\item{min_prominence}{Minimum prominence threshold for troughs (default: 0)}

\item{plateau_handling}{String specifying how to handle plateaus. One of:
\itemize{
\item "strict" (default): No points in plateau are troughs
\item "middle": Middle point(s) of plateau are troughs
\item "first": First point of plateau is trough
\item "last": Last point of plateau is trough
\item "all": All points in plateau are troughs
}}
}
\value{
A logical vector of the same length as the input where:
\itemize{
\item \code{TRUE} indicates a confirmed trough
\item \code{FALSE} indicates a non-trough
\item \code{NA} indicates trough status could not be determined due to missing data
}
}
\description{
Identifies troughs (local minima) in a numeric time series, with options to filter troughs based on
height and prominence. The function handles missing values (NA) appropriately and is compatible
with dplyr's mutate. Includes flexible handling of plateaus (consecutive equal values).
}
\details{
The function uses a three-point sliding window algorithm for basic trough detection,
combined with a region-based prominence calculation method similar to that described
in Palshikar (2009).
}
\note{
\itemize{
\item The function is optimized for use with dplyr's mutate
\item For noisy data, consider smoothing the series before trough detection
\item Adjust max_height and min_prominence to filter out unwanted troughs
\item Choose plateau_handling based on your specific needs
}
}
\section{Trough Detection}{
A point is considered a trough if it is strictly lower than both its immediate neighbors.
The first and last points in the series cannot be troughs and are always marked as NA.
}

\section{Prominence}{
Prominence measures how much a trough stands out relative to its surrounding values.
It is calculated as the height of the lowest maximum between this trough and any lower
troughs (or the end of the series if no lower troughs exist) minus the height of the trough.
}

\section{Plateau Handling}{
Plateaus (sequences of identical values) are handled according to the plateau_handling parameter:
\itemize{
\item strict: No points in a plateau are considered troughs (traditional behavior)
\item middle: For plateaus of odd length, the middle point is marked as a trough.
For plateaus of even length, the two middle points are marked as troughs.
\item first: The first point of each plateau is marked as a trough
\item last: The last point of each plateau is marked as a trough
\item all: Every point in the plateau is marked as a trough
}

Note that in all cases, the plateau must still qualify as a trough relative to its
surrounding points (i.e., lower than neighbors).
}

\section{Missing Values (NA) Handling}{
The function uses the following rules for handling NAs:
\itemize{
\item If a point is NA, it cannot be a trough (returns NA)
\item If either neighbor is NA, trough status cannot be determined (returns NA)
\item For prominence calculations, stretches of NAs are handled appropriately
\item A minimum of 3 points is required; shorter series return all NAs
}
}

\examples{
# Basic usage
x <- c(5, 3, 4, 1, 4, 2, 5)
find_troughs(x)

# With maximum height
find_troughs(x, max_height = 3)

# With plateau handling
x <- c(5, 2, 2, 2, 3, 1, 1, 4)
find_troughs(x, plateau_handling = "middle")  # Middle of plateaus
find_troughs(x, plateau_handling = "all")     # All plateau points

# With missing values
x <- c(5, 3, NA, 1, 4, NA, 5)
find_troughs(x)

# Usage with dplyr
library(dplyr)
data_frame(
  time = 1:10,
  value = c(5, 3, 1, 4, 2, 1, 3, 0, 4, 5)
) \%>\%
  mutate(troughs = find_troughs(value))

}
\references{
Palshikar, G. (2009). Simple Algorithms for Peak Detection in Time-Series.
Proc. 1st Int. Conf. Advanced Data Analysis, Business Analytics and Intelligence.
}
\seealso{
\itemize{
\item \code{\link{find_peaks}} for finding local maxima
\item \code{\link[pracma]{findpeaks}} in the pracma package for alternative extrema detection methods
}
}
